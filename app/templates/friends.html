<!DOCTYPE html>
<html>

<head>
  {% include 'header.html' %}
  <style>
    .friends {
      margin-left: 0;
      list-style: none;
    }

    .message-block {
      display: flex;
      align-items: top;
      position: relative;
      height: auto;
      width: 100%;
      margin-top: 10px;
      margin-bottom: 10px;
    }

    .message-block.left {
      justify-content: left;

    }

    .message-block.right {
      justify-content: right;
    }

    .message-avatar {
      display: block;
      width: 40px;
      height: 40px;
    }

    .message-text {
      display: flex;
      margin-bottom: 10px;
    }

    .message-block.left .message-text {
      text-align: left;
      margin-right: 60px;
    }

    .message-block.right .message-text {
      text-align: right;
      margin-left: 60px;
    }

    .message-block.left .message-text::before {
      width: 5px;
      height: 5px;
      border-top: 15px solid #5ac9e8;
      border-left: 15px solid transparent;
      margin-top: 10px;
      margin-left: 5px;
      content: " ";
    }

    .message-block.message-block.right .message-text::after {
      width: 5px;
      height: 5px;
      border-top: 15px solid #5ac9e8;
      border-right: 15px solid transparent;
      margin-top: 10px;
      margin-right: 5px;
      content: " ";
    }

    .message-span {
      display: inline-block;
      background-color: #5ac9e8;
      border-radius: 10px;
      padding: 10px;
      color: #ffffff;
    }

    a.button:hover {
      color: #ffffff;
    }
  </style>
</head>

<body>
  {% include 'nav.html' %}
  <section class="section">
    <div id="app" class="columns">
      <div class="column is-one-quarter" style="position: relative; min-height: 30rem;">
        <div class="panel" style="height: 100%;">
          <p class="panel-heading align-center is-capoo">
            {{ friend_list }}
          </p>
          <p class="control has-icons-left">
            <input class="input" style="border-radius: 0; box-shadow: none;" type="text" placeholder="搜索用户">
            <span class="icon is-left">
              <i class="fas fa-search" aria-hidden="true"></i>
            </span>
          </p>

          <div class="panel-block normal-color"
            style="display: block; position: absolute; top: 106.5px; bottom: 69px; left: 12px; right: 12px; overflow-y: scroll;">
            <aside class="menu">
              <p class="menu-label">
                {{ online }}
              </p>
              <ul class="menu-list friends">
                {% raw %}
                <li v-for="friend of online_friends"><a>{{ friend.name }}</a></li>
                {% endraw %}
              </ul>
              <p class="menu-label">
                {{ offline }}
              </p>
              <ul class="menu-list friends">
                {% raw %}
                <li v-for="friend of offline_friends"><a>{{ friend.name }}</a></li>
                {% endraw %}
              </ul>
            </aside>
          </div>

          <div class="panel-block normal-color"
            style="position: absolute; height: 58px; left: 12px; right: 12px; bottom: 12px;">
            <a href="#" class="card-footer-item is-capoo-2">{{ join_game }}</a>
            <a href="#" class="card-footer-item is-capoo-2">{{ delete_friend }}</a>
          </div>

        </div>

      </div>
      <div class="column" style="position: relative; min-height: 40rem;">
        <div class="panel" style="height: 100%;">
          {% raw %}
          <p class="panel-heading align-center is-capoo">{{ left_username }}</p>

          <ul class="panel-block normal-color"
            style="display: block; position: absolute; top: 66px; bottom: 69px; left: 12px; right: 12px; overflow-y: scroll;">
            <div v-for="msg of messages">

              <li v-if="msg.mine" class="message-block right">
                <p class="message-text">
                  <span class="message-span">{{ msg.content }}</span>
                </p>
                <img :src="right_avatar" class="message-avatar">
              </li>

              <li v-else class="message-block left">
                <img :src="left_avatar" class="message-avatar">
                <p class="message-text">
                  <span class="message-span">{{ msg.content }}</span>
                </p>
              </li>

            </div>

          </ul>
          {% endraw %}
          <div class="panel-block normal-color" style="position: absolute; left: 12px; right: 12px; bottom: 12px;">
            <input class="input" type="text">
            <a class="button is-capoo" style="margin-left: 10px;">{{ send }}</a>
          </div>

        </div>
      </div>
    </div>
  </section>
  <script>
    new Vue({
      el: '#app',
      data: {
        left_username: '先辈',
        left_avatar: '/static/avatar.png',

        right_username: 'capoo',
        right_avatar: '/static/favicon.png',

        all_friends: [],
        online_friends: [],
        offline_friends: [],

        messages: [
          {
            mine: false,
            content: '哼哼',
          },
          {
            mine: false,
            content: 'aaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaa aaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaa',
          },
          {
            mine: true,
            content: 'aaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaa aaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
          {
            mine: true,
            content: 'aaa',
          },
        ]
      },
      mounted: function () {
        
        
      },
      methods: {
        getUserName: function () {
          this.$http.get('/api/account/username').then(function (ret) {
            console.log(ret.body);
            if (ret.body.code == 0) {
              this.right_username = ret.body.username;
            } else {
              console.log('There is not logined user.');
            }
          }, function (ret) {
            console.log('Request fails, status:', ret);
          });
        },
        getFriendList: function () {
          this.$http.post('/api/account/userinfo', { username: this.right_username }, { emulateJSON: false }).then(function (ret) {
            console.log(ret.body);
            if (ret.body.code == 0) {
              this.all_friends = ret.body.friend_list;
              for (var i in this.all_friends) {
                console.log(i['name']);
              }
            } else {
              console.log('There is not logined user.');
            }
          }, function (ret) {
            console.log('Request fails, status:', ret);
          });
        },
      },
    });
  </script>

  {% include 'footer.html' %}

</body>

</html>